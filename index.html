<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>QSearch</title>

	<style>
		body {
			margin: 0;
			background: #000;
		}
		#logo {
			user-select: none;
			margin: 0;
			position: absolute;
			top: 1vh;
			left: 2vh;

			font-family: monospace;
			font-size: 2.5vh;
			color: #fff;

			b {
				/* color: #30f; */
				background: linear-gradient(to bottom, #30f 20%, #50f);
				background-clip: text;
				color: transparent;
			}
		}
	</style>
</head>
<body>
	<p id="logo"><b>Q</b>Search</p>

	<script>
		function mapKeys(obj, func) {
			if (Array.isArray(obj)) {
				return obj.map(item => mapKeys(item, func));
			} else if (obj !== null && typeof obj === 'object') {
				return Object.fromEntries(
					Object.entries(obj).map(([key, value]) => [
						func(key),
						mapKeys(value, func)
					])
				);
			}
			return obj;
		}

		let tree = {};
		function init(urls) {
			let modules = [];
			urls.forEach(url => {
				fetch(url)
					.then(response => response.text())
					.then(module => JSON.parse(modules.push(module)))
					.catch(error => console.error(`Error loading module ${url}:`, error));
			});

			modules.reverse();
			modules = modules.map(m => { mapKeys(m, k => k === '*' ? k : k.toLowerCase().replace(/[^a-zA-Z0-9_-]/g, '') ) });

			tree = Object.assign({}, ...modules);
		}

		function suggest(query) {
			if (!query) return [];

			query = query.toLowerCase().split(' ');
			let curTree = tree;
			for (let i = 0; i < query.length; i++) {
				if (Object.hasOwn(curTree, query[i])) {
					curTree = curTree[query[i]];
				} else {
					return Object.keys(curTree).map(i => i === '' ? '[enter]' : i);
				}
			}
		}
	</script>
</body>
</html>